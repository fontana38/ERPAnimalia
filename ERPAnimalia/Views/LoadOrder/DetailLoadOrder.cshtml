<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Detalle Producto</title>

    <script src="~/Scripts/jquery-2.1.4.min.js"></script>
    <script src="~/Scripts/jquery.1.10.1.js"></script>
    <script src="~/Scripts/gijgo.js"></script>
    
 <script type="text/javascript">

     $(document).ready(function () {
         gridProduct = $("#gridProduct").grid({
             dataKey: "IdProducto",
             uiLibrary: "bootstrap",
             columns: [
             { field: "IdProducto", hidden: true },
             { field: "CodigoBarra", title: "Código de Barra", sortable: true, width: 80 },
             { field: "Codigo", title: "Código", sortable: true, width: 80 },
             { field: "Marca", title: "Marca", sortable: true, width: 150 },
             { field: "Descripcion1", title: "Descripcion 1", sortable: true, width: 200 },
             { field: "Descripcion2", title: "Descripcion 2", sortable: true, width: 200 },
             { field: "SubCategoryName", title: "SubCategoria", sortable: true, width: 100 },
             { field: "CategoryName", title: "Categoria", sortable: true, width: 100 },
             { field: "kg", title: "Kg", sortable: true, width: 80 },
             { field: "Cantidad", title: "Stock Actual", sortable: true, width: 80 },
             { field: "CantidadPedida", title: "Cantidad",editor: true, sortable: true, width: 80 },
             { field: "PrecioCosto", title: "Precio Costo", editor: true,sortable: true, width: 80 },
             { field: "PrecioVenta", title: "Precio Venta",editor: true, sortable: true, width: 80 }
             
             ],
             selectionMethod: 'checkbox',
             selectionType: 'multiple',
             pager: { enable: true, limit: 5, sizes: [2, 5, 10, 20] }
         });

             $("#btnSearchGridProduct").on("click", SearchProduct);
             $("#btnSave").on("click", Save);

             $('#search').keypress(function (event) {
                 debugger;
                 if (event.keyCode == 13) {
                     $("#btnSearchGridProduct").click();
                 }
             });

         });



         function SearchProduct() {
           
             gridProduct.reload({ searchString: $("#search").val() });
         }

       

         function Save() {
           
             var cantidad= new Array();
             var precioCosto=new Array();
             var idProducto=new Array();
             var precioVenta=new Array();

             var selections = gridProduct.getSelections();
             if ($('#RazonSocial').val() == "")
             {
                 return alert("Debe Seleccionar Un Proveedor");
             }
             if (selections.length!= 0)
             {           
                 $(selections).each(function (index, element) {
                
                 var row = gridProduct.get(element);
                 idProducto[index] = row.IdProducto;
                 precioCosto[index]=row.PrecioCosto;
                 cantidad[index]=row.CantidadPedida;
                 precioVenta[index]=row.PrecioVenta;

             });
             }
             else
             {
                return alert("Debe Seleccionar Un Producto");
             }

             var  proveedor= $("#RazonSocial").val();
             var  formaPago= $("#formaPago").val();
             var date= $("#date").val();
             var fechaPago = $("#fechaPago").val();

             $.ajax({ url: "/LoadOrder/Save", type: "POST", data: { proveedor: proveedor, date: date, fechaPago:fechaPago,formaPago: formaPago, idProducto: idProducto,precioCosto:precioCosto,cantidad:cantidad,precioVenta:precioVenta } })
                 .done(function (data) {
                     $("#RazonSocial").val("");
                     gridProduct.clear();
                     alert("La orden fue guardad con éxito");
                     gridProduct.reload();
                 })
                 .fail(function () {
                     alert("Unable to save.");

                 });
         }


  </script>

</head>
<body>
   
   <div class="panel-heading">Producto</div>
    <div class="panel-body">
        <div class="form-group row">
            <div class="col-md-3 col-md-offset-1">
                <div class="input-group">
                    <input type="text" id="search" class="form-control" placeholder="Search for...">
                    <span class="input-group-btn">
                        <button type="button" id="btnSearchGridProduct" class="btn btn-default">Go!</button>
                    </span>

                </div>
                <br />
                <button type="button" class="btn btn-primary" onclick="location.href='@Url.Action("Create", "Product")'">Agregar Producto</button>
                <button type="button" class="btn btn-primary" id="btnSave">Guardar</button>
            </div>

        </div>
    </div>
        <br />
        <table id="gridProduct" data-source="@Url.Action("GetProduct")"></table>
   
</body>
</html>